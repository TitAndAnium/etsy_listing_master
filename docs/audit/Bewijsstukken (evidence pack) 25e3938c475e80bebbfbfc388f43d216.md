# Bewijsstukken (evidence pack)

- **.env management & gitignore:** In projectbeslissing log is expliciet vastgelegd dat `.env` (root en functions) aan .gitignore zijn toegevoegd als beveiligingsmaatregel. Tevens bevestigt Cascade Instelrapport dat .env-waarden via `process.env` worden gebruikt en nooit hardcoded in code.
- **Secret placeholders geslaagd:** Na implementatie van secret-hygiene meldt het log: “Secret placeholders geneutraliseerd (OPENAI, SLACK, STRIPE) → secret-scan checks pass.”. Dit bewijst dat er geen echte keys meer in de repo stonden en CI dit heeft gevalideerd.
- **Creditsysteem in code:** Uit `project_decisions_and_logs_v2.md` blijkt dat `utils/credits.js` is toegevoegd met ensure/consumeCredits, en geïntegreerd in generateFromDumpCore (pre-check + aftrek). Ook is te zien dat overschrijding nu leidt tot *“429 Daily credits exhausted”* errors.
- **In-memory vs. Firestore TODO:** In de code zelf staat een duidelijke `// TODO: Firestore transaction – atomic increment` in `credits.js`, wat bevestigt dat de huidige implementatie nog niet naar Firestore schrijft voor credit verbruik.
- **Auth afwezig op main endpoints:** De functie exports in `functions/index.js` laten zien dat `api_generateListingFromDump` en `api_generateChainingFromFields` direct via onRequest worden geëxporteerd, zonder auth-check (enkel een `cors()` wrapper). In contrast is te zien dat bij `api_getUserCredits` wél eerst een bearer token wordt gevalideerd in handleGetUserCredits (met `admin.auth().verifyIdToken`). Het verschil onderstreept het gat: generate endpoints hebben dat niet. Daarnaast toont de call in `api_generateListingFromDump` dat er een vaste `"unknown"` als uid wordt meegegeven aan de core functie, i.p.v. een echte userID.
- **Payment mismatch risico:** De Stripe checkout handler code snippet laat zien dat zowel `credits` als `amount_cents` uit de request-body komen en direct worden gebruikt in de Session aanmaak. Er is geen server-calculatie of limit. Bijvoorbeeld: `credits=100, amount_cents=500` (dus €5,00) zou 100 credits opleveren, wat niet overeenkomt met de beoogde prijzen in Masterdoc (100 credits zouden ~€30 moeten kosten). Dit bevestigt de kwetsbaarheid in de huidige logica.
- **Stripe webhook veiligheid:** In de Stripe webhook function wordt de signature header gecontroleerd: `Stripe.webhooks.constructEvent(req.rawBody, sig, webhookSecret)`. Vervolgens wordt bij event type `checkout.session.completed` het `session.metadata` gebruikt om credits toe te kennen in Firestore via een transaction. Dit toont dat alleen echte Stripe-callbacks met juiste signing iets kunnen triggeren, en dat de credit-bijboeking netjes atoom gebeurt.
- **Logging volledigheid:** Uit releasechecklist blijkt dat voor logging alle vereiste velden aanwezig zijn en bijvoorbeeld `retry_reason`, `fallback_model_used`, `token_usage` inderdaad worden gelogd. In een audit-fix log vermeldt men ook “Logging validatie: verplichte velden afgedwongen” en “Firestore logging: retry_reason, fallback_model_used, token_usage geverifieerd”. Deze stukken bewijzen dat logging volgens spec werkt.
- **Validatie & test KPI:** Project logs tonen dat na prompt-upgrade v2.7 een praktische validatie is gedaan: titel, tags, description allen ✅ aan de eisen voldeden, 100% success rate. Tevens bij validator v4 implementatie: 32/38 tests passed = 84.2%, wat voldoet aan de ≤20% fail soft limit. Dit dient als bewijs dat de implementatie output kwaliteitsdoelen behaalt.
- **CI status en fixes:** Changelog vermeldt *“Test suite groen, Slack live, logging opgeschoond”* en een eerdere entry noteert een `npm audit fix` voor een kritieke vuln in een dependency. Deze geven aan dat de CI-pipeline actief zwakke plekken heeft opgespoord en verholpen, wat de gereedheid verhoogt.

*(Bovenstaande **bewijsstukken** refereren aan regels uit de ingediende projectdocumentatie en code, ter ondersteuning van de auditbevindingen.)*